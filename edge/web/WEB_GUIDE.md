# Edge设备管理系统 - Web前端使用指南

## 🎉 欢迎使用

这是一个功能完整、界面美观的设备管理Web应用，专为Edge储能柜边缘认证网关设计。

## 📦 已完成的功能

### 1. 设备监控仪表板
- **实时统计卡片**：显示设备总数、在线设备、离线设备、故障设备
- **传感器类型分布**：直观展示各类传感器的数量分布
- **自动刷新**：每30秒自动更新数据

### 2. 设备管理
- **设备列表**：
  - 分页展示（每页20条，可配置）
  - 显示设备ID、类型、状态、型号等信息
  - 状态徽章（在线/离线/禁用/故障）
  - 最后在线时间显示（支持相对时间）

- **设备过滤**：
  - 按状态筛选（在线/离线/禁用/故障）
  - 按传感器类型筛选（CO2、CO、烟雾等7种类型）
  - 实时搜索（支持设备ID和型号模糊匹配）

- **设备注册**：
  - 表单验证
  - 支持所有必填和可选字段
  - ZKP公钥和承诺值输入

- **设备编辑**：
  - 一键加载现有设备信息
  - 实时更新
  - 表单验证

- **设备详情**：
  - 完整的设备信息展示
  - ZKP信息查看
  - 时间信息展示

- **设备删除**：
  - 确认对话框
  - 安全删除

### 3. 用户界面
- **响应式设计**：完美支持桌面、平板、手机
- **深色侧边栏**：现代化蓝色渐变导航
- **Toast通知**：操作反馈（成功/错误/警告/信息）
- **加载状态**：优雅的loading动画
- **模态框**：美观的表单弹窗
- **分页组件**：智能页码显示

### 4. 技术特性
- **纯原生JavaScript**：无框架依赖，轻量高效
- **ES6+语法**：现代化代码风格
- **模块化设计**：清晰的代码组织
- **RESTful API**：完整的后端集成
- **错误处理**：友好的错误提示
- **防抖优化**：搜索输入优化
- **自动刷新**：定期更新数据

## 🚀 快速启动

### 方式一：使用启动脚本（推荐）

```bash
# 确保后端服务已启动
cd /home/uestc/Edge
./bin/edge -config ./configs/config.yaml

# 新开终端，启动前端
./start_web.sh
```

### 方式二：手动启动

```bash
# 启动后端
cd /home/uestc/Edge
./bin/edge -config ./configs/config.yaml

# 新开终端，启动前端
cd /home/uestc/Edge/web
python3 -m http.server 8000
```

### 方式三：一键启动（两个终端）

**终端1 - 后端**：
```bash
cd /home/uestc/Edge && ./bin/edge -config ./configs/config.yaml
```

**终端2 - 前端**：
```bash
cd /home/uestc/Edge && ./start_web.sh
```

## 🎯 使用教程

### 首次访问

1. 在浏览器打开 `http://localhost:8000`
2. 默认进入仪表板页面
3. 查看统计信息（如果数据库为空，统计会显示0）

### 注册第一个设备

1. 点击左侧导航「设备管理」
2. 点击右上角「注册新设备」按钮
3. 填写设备信息：
   - **设备ID**（必填）：例如 `SENSOR_001`
   - **储能柜ID**（必填）：例如 `CABINET_A1`
   - **传感器类型**（必填）：选择一种类型
   - **公钥**（必填）：输入ZKP公钥（测试可以随意输入）
   - **承诺值**（必填）：输入ZKP承诺值（测试可以随意输入）
   - 其他可选字段：型号、制造商、固件版本等
4. 点击「保存」
5. 设备列表自动刷新，显示新注册的设备

### 快速创建测试设备

打开浏览器控制台（F12），输入：

```javascript
App.generateTestDevice()
```

这将自动创建一个测试设备，包含所有必要的字段。

### 查看设备详情

1. 在设备列表中，点击某个设备的「查看」按钮
2. 弹出详情窗口，显示完整设备信息
3. 包括基本信息、ZKP信息、时间信息

### 编辑设备

1. 点击设备的「编辑」按钮
2. 弹出编辑表单，自动填充现有信息
3. 修改需要更新的字段
4. 点击「保存」

### 删除设备

1. 点击设备的「删除」按钮
2. 确认删除操作
3. 设备从列表中移除

### 过滤和搜索

1. **按状态过滤**：选择状态下拉框（在线/离线/禁用/故障）
2. **按类型过滤**：选择传感器类型下拉框
3. **搜索**：在搜索框输入设备ID或型号，实时过滤

### 查看统计

1. 点击左侧导航「仪表板」
2. 查看四个统计卡片：
   - 设备总数
   - 在线设备
   - 离线设备
   - 故障设备
3. 查看传感器类型分布

## 📊 代码统计

```
文件结构：
web/
├── index.html (345行)      - 主页面结构
├── css/
│   └── styles.css (902行)  - 完整样式
└── js/
    ├── api.js (159行)      - API调用封装
    ├── ui.js (249行)       - UI工具函数
    ├── devices.js (421行)  - 设备管理逻辑
    └── app.js (255行)      - 主应用入口

总计：2,331行代码
```

## 🎨 界面预览

### 仪表板
- 顶部4个统计卡片（蓝/绿/黄/红配色）
- 传感器类型分布网格
- 自动刷新数据

### 设备管理
- 过滤栏（状态、类型、搜索）
- 设备表格（带状态徽章）
- 分页组件
- 操作按钮（查看、编辑、删除）

### 设备表单
- 模态框形式
- 清晰的表单布局
- 必填项标记
- 输入提示
- 保存/取消按钮

### 设备详情
- 三个信息卡片：
  - 基本信息
  - 零知识证明信息
  - 时间信息
- 整洁的表格展示

## 🛠️ 调试技巧

打开浏览器控制台（F12），使用以下命令：

```javascript
// 查看当前应用状态
App

// 查看设备管理器
DeviceManager

// 创建测试设备
App.generateTestDevice()

// 重新加载设备列表
DeviceManager.loadDevices()

// 重新加载统计信息
DeviceManager.loadStatistics()

// 健康检查
API.healthCheck()

// 查看当前设备数据
DeviceManager.devices

// 查看统计数据
DeviceManager.statistics
```

## 🐛 常见问题

### Q: 页面显示"无法连接到后端服务"？
**A**: 检查后端是否启动：
```bash
curl --noproxy '*' http://localhost:8001/health
```
应该返回 `{"status":"ok",...}`

### Q: 设备列表为空？
**A**: 数据库可能还没有设备：
1. 点击「注册新设备」手动添加
2. 或在控制台运行 `App.generateTestDevice()` 创建测试设备

### Q: 无法注册设备？
**A**: 检查：
1. 所有必填字段是否已填写
2. 设备ID是否唯一（不能重复）
3. 浏览器控制台是否有错误信息

### Q: 修改代码后没有生效？
**A**: 
1. 强制刷新页面（Ctrl+Shift+R 或 Cmd+Shift+R）
2. 清除浏览器缓存
3. 检查文件是否保存

### Q: 样式显示异常？
**A**: 
1. 检查是否正确加载了Font Awesome（需要网络）
2. 查看浏览器控制台的CSS加载错误
3. 确认使用HTTP服务器访问（不是file://协议）

## 🔐 安全说明

当前版本是开发版本，**未实现完整的认证授权**：

- ❌ JWT认证（代码已预留，但未启用）
- ❌ 用户登录
- ❌ 权限控制

**生产环境使用前需要**：
1. 实现用户登录功能
2. 启用JWT认证
3. 添加CSRF防护
4. 使用HTTPS
5. 添加访问控制

## 📝 后续开发计划

1. **认证系统**：用户登录、JWT令牌管理
2. **数据采集页面**：实时数据展示、历史数据查询
3. **告警管理**：告警列表、告警处理
4. **统计分析**：图表展示、趋势分析
5. **系统设置**：配置管理、用户管理
6. **实时推送**：WebSocket集成、实时通知

## 🎓 学习资源

- **HTML/CSS/JavaScript**：MDN Web Docs
- **RESTful API**：查看 `device.md` 和后端文档
- **设备管理**：参考 `device.md` 接口文档

## 💡 最佳实践

1. **开发时**：使用浏览器开发者工具调试
2. **测试时**：先创建几个测试设备
3. **部署时**：使用专业的Web服务器（Nginx、Apache）
4. **生产环境**：启用HTTPS和认证

## 🤝 贡献

欢迎贡献代码和建议！

- Issue反馈：报告Bug或提出需求
- Pull Request：提交代码改进
- 文档完善：补充使用说明

---

**祝您使用愉快！** 🎉

如有问题，请查看 `web/README.md` 或项目文档。

