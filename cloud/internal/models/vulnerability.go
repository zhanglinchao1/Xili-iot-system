package models

import "time"

// VulnerabilityAssessment 脆弱性评估记录
type VulnerabilityAssessment struct {
	ID                      int64     `json:"id" db:"id"`
	CabinetID               string    `json:"cabinet_id" db:"cabinet_id"`
	Timestamp               time.Time `json:"timestamp" db:"timestamp"`
	LicenseComplianceScore  float64   `json:"license_compliance_score" db:"license_compliance_score"`
	CommunicationScore      float64   `json:"communication_score" db:"communication_score"`
	ConfigSecurityScore     float64   `json:"config_security_score" db:"config_security_score"`
	DataAnomalyScore        float64   `json:"data_anomaly_score" db:"data_anomaly_score"`
	OverallScore            float64   `json:"overall_score" db:"overall_score"`
	RiskLevel               string    `json:"risk_level" db:"risk_level"`
	TransmissionMetrics     *string   `json:"transmission_metrics,omitempty" db:"transmission_metrics"`
	TrafficFeatures         *string   `json:"traffic_features,omitempty" db:"traffic_features"`
	ConfigChecks            *string   `json:"config_checks,omitempty" db:"config_checks"`
	DetectedVulnerabilities *string   `json:"detected_vulnerabilities,omitempty" db:"detected_vulnerabilities"`
	SyncedFromEdge          bool      `json:"synced_from_edge" db:"synced_from_edge"`
	ReceivedAt              time.Time `json:"received_at" db:"received_at"`
}

// VulnerabilityEvent 漏洞事件详情
type VulnerabilityEvent struct {
	ID           int64     `json:"id" db:"id"`
	AssessmentID int64     `json:"assessment_id" db:"assessment_id"`
	CabinetID    string    `json:"cabinet_id" db:"cabinet_id"`
	EventType    string    `json:"event_type" db:"event_type"`
	Category     string    `json:"category" db:"category"`
	Title        string    `json:"title" db:"title"`
	Severity     string    `json:"severity" db:"severity"`
	Description  string    `json:"description" db:"description"`
	Solution     *string   `json:"solution,omitempty" db:"solution"`
	DetectedAt   time.Time `json:"detected_at" db:"detected_at"`
	CreatedAt    time.Time `json:"created_at" db:"created_at"`
}

// VulnerabilitySyncRequest Edge端同步请求
type VulnerabilitySyncRequest struct {
	CabinetID               string                 `json:"cabinet_id" binding:"required"`
	Timestamp               time.Time              `json:"timestamp"`
	LicenseComplianceScore  float64                `json:"license_compliance_score"`
	CommunicationScore      float64                `json:"communication_score" binding:"required"`
	ConfigSecurityScore     float64                `json:"config_security_score" binding:"required"`
	DataAnomalyScore        float64                `json:"data_anomaly_score" binding:"required"`
	OverallScore            float64                `json:"overall_score" binding:"required"`
	RiskLevel               string                 `json:"risk_level" binding:"required"`
	TransmissionMetrics     map[string]interface{} `json:"transmission_metrics,omitempty"`
	TrafficFeatures         []float64              `json:"traffic_features,omitempty"`
	ConfigChecks            map[string]bool        `json:"config_checks,omitempty"`
	DetectedVulnerabilities []VulnerabilityEventDTO `json:"detected_vulnerabilities,omitempty"`
}

// VulnerabilityEventDTO 漏洞事件DTO (从Edge端传输)
type VulnerabilityEventDTO struct {
	Type        string    `json:"type"`
	Category    string    `json:"category"`
	Title       string    `json:"title"`
	Severity    string    `json:"severity"`
	Description string    `json:"description"`
	Solution    string    `json:"solution"`
	DetectedAt  time.Time `json:"detected_at"`
}

// VulnerabilityListQuery 脆弱性评估列表查询
type VulnerabilityListQuery struct {
	CabinetID string    `form:"cabinet_id"`
	StartTime time.Time `form:"start_time"`
	EndTime   time.Time `form:"end_time"`
	RiskLevel string    `form:"risk_level"`
	Page      int       `form:"page"`
	PageSize  int       `form:"page_size"`
}

// VulnerabilityListResponse 脆弱性评估列表响应
type VulnerabilityListResponse struct {
	Items      []*VulnerabilityAssessment `json:"items"`
	Total      int64                      `json:"total"`
	Page       int                        `json:"page"`
	PageSize   int                        `json:"page_size"`
	TotalPages int                        `json:"total_pages"`
}

// VulnerabilityDetailResponse 脆弱性评估详情响应
type VulnerabilityDetailResponse struct {
	Assessment *VulnerabilityAssessment `json:"assessment"`
	Events     []*VulnerabilityEvent    `json:"events"`
}
