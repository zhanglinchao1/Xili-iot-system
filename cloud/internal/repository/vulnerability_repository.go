package repository

import (
	"context"
	"time"

	"cloud-system/internal/models"
)

// VulnerabilityRepository 脆弱性评估数据访问接口
type VulnerabilityRepository interface {
	// CreateAssessment 创建评估记录
	CreateAssessment(ctx context.Context, assessment *models.VulnerabilityAssessment) (int64, error)

	// CreateEvents 批量创建漏洞事件
	CreateEvents(ctx context.Context, events []*models.VulnerabilityEvent) error

	// GetLatestByCabinetID 获取储能柜最新评估
	GetLatestByCabinetID(ctx context.Context, cabinetID string) (*models.VulnerabilityAssessment, error)

	// GetAssessmentByID 根据ID获取评估
	GetAssessmentByID(ctx context.Context, id int64) (*models.VulnerabilityAssessment, error)

	// GetEventsByAssessmentID 获取评估的所有漏洞事件
	GetEventsByAssessmentID(ctx context.Context, assessmentID int64) ([]*models.VulnerabilityEvent, error)

	// ListAssessments 分页查询评估记录
	ListAssessments(ctx context.Context, query *models.VulnerabilityListQuery) ([]*models.VulnerabilityAssessment, int64, error)

	// GetHistoryByCabinetID 获取储能柜历史评估
	GetHistoryByCabinetID(ctx context.Context, cabinetID string, startTime, endTime time.Time, limit int) ([]*models.VulnerabilityAssessment, error)

	// DeleteOldAssessments 删除旧评估数据
	DeleteOldAssessments(ctx context.Context, beforeTime time.Time) error

	// GetStatsByCabinetID 获取储能柜评估统计
	GetStatsByCabinetID(ctx context.Context, cabinetID string, days int) (map[string]interface{}, error)
}
